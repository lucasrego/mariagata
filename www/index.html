<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="apple-touch-startup-image-640x1096.png">
<title>Escovaria e Esmalteria Maria Gata</title>
<link rel="stylesheet" href="css/framework7.css">
<link rel="stylesheet" href="style.css">

<link rel="stylesheet" href="css/colors/grayscale.css">
<link type="text/css" rel="stylesheet" href="css/swipebox.css" />
<link type="text/css" rel="stylesheet" href="css/animations.css" />
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,900' rel='stylesheet' type='text/css'>


</head>
<body id="mobile_wrap">

    <div class="statusbar-overlay"></div>

    <div class="panel-overlay"></div>

    <div class="panel panel-left panel-cover">
          <div class="user_login_info">
            <div class="user_thumb">
				<img src="images/profile.jpg" alt="" title="" />
				  <div class="user_details">
					<!--<p>Oi, <span>Juliana</span></p>-->
				  </div>  
				  <div class="user_social">
					<!--
					<a href="#" data-popup=".popup-social" class="open-popup"><img src="images/icons/white/twitter.png" alt="" title="" /></a>
					-->
				  </div>      
            </div>

                <nav class="user-nav">
                    <ul>
						<li><a href="#" data-popup=".popup-login" class="open-popup close-panel"><img src="images/icons/white/lock.png" alt="" title="" /><span>Login</span></a></li>
						<li><a href="agendar.html"><img src="images/icons/white/blog.png" alt="" title="" /><span>Agendar</span></a></li>
						<li><a href="agendamentos.html"><img src="images/icons/white/heart.png" alt="" title="" /><span>Meus Agendamentos</span><strong class="green">12</strong></a></li>
						<li><a href="#" data-popup=".popup-signup" class="open-popup close-panel"><img src="images/icons/white/user.png" alt="" title="" /><span>Meu Cadastro</span></a></li>
						<li><a href="#" class="btnWhatsapp"><img src="images/icons/white/call.png" alt="" title="" /><span>Agende pelo Whatsapp</span></a></li>
						<li><a href="localizacao.html" ><img src="images/icons/white/map.png" alt="" title="" /><span>Como Chegar</span></a></li>
                    </ul>
                </nav>
          </div>
    </div>

    
    <div class="views">

      <div class="view view-main">

        <div class="pages toolbar-through">

			<div data-page="index" class="page homepage">
				<div class="page-content">
					<div class="logo"><img src="images/logo.png" alt="" title="" /></div> 
				</div>
			</div>
        </div>
        <!-- MENU INFERIOR -->
        <div class="toolbar">
			<div class="toolbar-inner">
				<ul class="toolbar_icons">
					<li><a href="agendar.html"><img src="images/icons/white/blog.png" alt="Agendar Visita" title="Agendar Visita" /></a></li>
					<li><a href="agendamentos.html"><img src="images/icons/white/heart.png" alt="Meus Agendamentos" title="Meus Agendamentos" /></a></li>
					<li class="menuicon"><a href="#" data-panel="left" class="open-panel"><img src="images/icons/white/menu.png" alt="" title="" /></a></li>			  
					<li><a href="#" class="btnWhatsapp"><img src="images/icons/white/call.png" alt="Agende pelo WhatsApp" title="Agende pelo WhatsApp" /></a></li>
					<li><a href="localizacao.html"><img src="images/icons/white/map.png" alt="Como Chegar" title="Como Chegar" /></a></li>
				</ul>
			</div>  
        </div>
		
      </div>
    </div>
    
    <!-- About Popup -->
    <div class="popup popup-menu">
    <div class="content-block">
              <nav class="main-nav">
                <ul>
                  <li><a href="index.html" class="close-popup"><img src="images/icons/white/home.png" alt="" title="" /><span>Home</span></a></li>
                  <li><a href="about.html" class="close-popup"><img src="images/icons/white/user.png" alt="" title="" /><span>About</span></a></li>
                  <li><a href="features.html" class="close-popup"><img src="images/icons/white/settings.png" alt="" title="" /><span>Features</span></a></li>
                  <li><a href="photos.html" class="close-popup"><img src="images/icons/white/photos.png" alt="" title="" /><span>Gallery</span></a></li>
                  <li><a href="videos.html" class="close-popup"><img src="images/icons/white/video.png" alt="" title="" /><span>Videos</span></a></li>
                  <li><a href="blog.html" class="close-popup"><img src="images/icons/white/blog.png" alt="" title="" /><span>Blog</span></a></li>
                  <li><a href="toggle.html" class="close-popup"><img src="images/icons/white/toogle.png" alt="" title="" /><span>Toggle</span></a></li>
                  <li><a href="tabs.html" class="close-popup"><img src="images/icons/white/docs.png" alt="" title="" /><span>Tabs</span></a></li>
                  <li><a href="#" data-popup=".popup-social" class="open-popup"><img src="images/icons/white/heart.png" alt="" title="" /><span>Social</span></a></li>
                  <li><a href="#" data-popup=".popup-login" class="open-popup"><img src="images/icons/white/lock.png" alt="" title="" /><span>Login</span></a></li>
                  <li><a href="tel:1234 5678" class="close-popup external"><img src="images/icons/white/phone.png" alt="" title="" /><span>Call Now</span></a></li>
                  <li><a href="contact.html" class="close-popup"><img src="images/icons/white/contact.png" alt="" title="" /><span>Contact</span></a></li>
                </ul>
              </nav>  
      <div class="close_popup_button"><a href="#" class="close-popup"><img src="images/icons/black/menu_close.png" alt="" title="" /></a></div>
    </div>
    </div> 
    
    
    <!-- INFORMAR/ALTERAR DADOS USUÁRIO -->
    <div class="popup popup-signup">
		<div class="content-block-login">
		    <div class="form_logo"><img src="images/logo.png" alt="" title="" /></div>
				<h4>INFORME SEUS DADOS</h4>
				<!--<div class="loginform">-->
				<div class="mariagataform">
					<!--<form id="LoginForm" method="post">-->
					<form id="frmCadastro" method="post">
						<input type="text" name="cadastro_nome" id="cadastro_nome" value="" class="form_input required" placeholder="Primeiro Nome" />
						<input type="text" name="cadastro_cpf" id="cadastro_cpf" value="" class="form_input required" placeholder="CPF" />
						<input type="text" name="cadastro_email" id="cadastro_email" value="" class="form_input required" placeholder="E-mail" />
						<input type="text" name="cadastro_celular" id="cadastro_celular" value="" class="form_input required" placeholder="celular (com DDD)" />
						
						<input type="submit" name="submit" class="form_submit" id="submit" value="SALVAR" />
					</form>
				</div>
		  <div class="close_loginpopup_button"><a href="#" class="close-popup"><img src="images/icons/black/menu_close.png" alt="" title="" /></a></div>
		</div>
    </div>


<script type="text/javascript" src="js/jquery-1.10.1.min.js"></script>
<script src="js/jquery.validate.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/framework7.js"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/my-app.js"></script>
<script type="text/javascript" src="js/jquery.fitvids.js"></script>


	<script>
		
		$( document ).ready(function() {
			
			//document.addEventListener('pagebeforecreate', function(event) {
			//});
			
			// Wait for Cordova to load
			document.addEventListener("deviceready", onDeviceReady, false);
			
			function onDeviceReady() {
				
				//Local Notification: https://github.com/katzer/cordova-plugin-local-notifications/wiki
				//cordova.plugins.notification.local.schedule({
				//	title: "Lembrete Maria Gata",
				//	message: "Oi, está lembrada do seu agendamento na Maria Gata? Esperamos você lá!! Se não puder comparecer, não deixe de nos avisar, ok?! ;)."
				//});
				
				alert("onDeviceReady index1");
				navigator.vibrate(1000); 
				
				$$(document).on('click', '.btnEsmalteriaDisponivel', function (e) {
					navigator.vibrate(300);
					//Limpa a classe dos botões btnEsmalteriaDisponivel. Se não estiver disabled, aplica css do botão selecionado
					$('.btnEsmalteriaDisponivel').removeClass("btnSelecionado").addClass( "btnEsmalteria" );
					$(e.target).removeClass( "btnEsmalteria" ).addClass( "btnSelecionado" );
				});

				$$(document).on('click', '.btnEscovariaDisponivel', function (e) {
					navigator.vibrate(300);
					//Limpa a classe dos botões btnEscovaria. Se não estiver disabled, aplica css do botão selecionado
					$('.btnEscovariaDisponivel').removeClass("btnSelecionado").addClass( "btnEscovaria" );
					$(e.target).removeClass( "btnEscovaria" ).addClass( "btnSelecionado" );
				});
				
				$$(document).on('click', '#btnConcluirAgendamento', function (e) {
		
					//Se já tiver os dados de login e cadastro no BD, conclui o agendamento. Caso contrário, abre popup de login/cadastro.
					
					navigator.vibrate(1000);
					
					console.log("antes openDatabase11");
					var db = window.sqlitePlugin.openDatabase({name: "mariagata", location: 1});
					console.log("depois openDatabase22");
					
					db.transaction(function(tx) {
						console.log("1");
						tx.executeSql('DROP TABLE IF EXISTS usuario');
						console.log("2");
						tx.executeSql('CREATE TABLE IF NOT EXISTS usuario (id integer primary key, cpf text, nome text, email text, celular text)');
						console.log("3");
						
						tx.executeSql("INSERT INTO usuario (cpf, nome, email, celular) VALUES (?,?,?,?)", ["80941818500", "Lucas","lucasrego@gmail.com","7188145976"], function(tx, res) {
							alert("insertId: " + res.insertId + " -- should be valid");
						}, function(e) {
							alert("ERROR 1: " + e.message);
						});
					});
					
					
					db.transaction(function(tx) {
						tx.executeSql("select cpf, nome, email, celular from usuario;", [], function(tx, res) {
							//console.log("res.rows.length: " + res.rows.length + " -- should be 1");
							//alert("res.rows.item(0).data_num: " + res.rows.item(0).data_num + " -- should be 100");
						
							if (res.rows.item(0).cpf == "") {
								alert("antes popup");
								myApp.popup('.popup-signup');
								return false;
							} else {
								alert("cpf diferente de vazio.");
								
								$("#cadastro_cpf").val(res.rows.item(0).cpf);
								$("#cadastro_nome").val(res.rows.item(0).nome);
								$("#cadastro_email").val(res.rows.item(0).email);
								$("#cadastro_celular").val(res.rows.item(0).celular);
								
								myApp.popup('.popup-signup');
								return false;
							}
						});
					});
					
					var IdProfissionalEsmalteria = "";
					var nomeProfissionalEsmalteria = "";
					var horarioEsmalteria = "";
					var IdProfissionalEscovaria = "";
					var nomeProfissionalEscovaria = "";
					var horarioEscovaria = "";
					var msgNaoSelecionado = "";
					var idSelecionadoEsmalteria = "";
					var idSelecionadoEscovaria = "";
					
					if (temEsmalteria) {
						idSelecionadoEsmalteria = $('.btnEsmalteriaDisponivel.btnSelecionado').attr('id');
						if (idSelecionadoEsmalteria === undefined) {
							msgNaoSelecionado = "Selecione um profissional e horário para o(s) serviço(s) da Esmalteria.";
						} else {
							nomeProfissionalEsmalteria = idSelecionadoEsmalteria.split("|")[0];
							IdProfissionalEsmalteria = idSelecionadoEsmalteria.split("|")[1];
							horarioEsmalteria = idSelecionadoEsmalteria.split("|")[2];
						}			
					}
					if (temEscovaria) {
						idSelecionadoEscovaria = $('.btnEscovariaDisponivel.btnSelecionado').attr('id');
						if (idSelecionadoEscovaria === undefined) {
							if ((temEsmalteria)&&((idSelecionadoEsmalteria === undefined)||(idSelecionadoEsmalteria == ""))) {
								msgNaoSelecionado = "Selecione profissionais e horários para o(s) serviço(s) da Esmalteria e Escovaria.";
							} else {
								msgNaoSelecionado = "Selecione um profissional e horário para o(s) serviço(s) da Escovaria.";
							}
						} else {
							nomeProfissionalEscovaria = idSelecionadoEscovaria.split("|")[0];
							IdProfissionalEscovaria = idSelecionadoEscovaria.split("|")[1];
							horarioEscovaria = idSelecionadoEscovaria.split("|")[2];
						}
					}
					
					if (msgNaoSelecionado != "") {
						myApp.alert(msgNaoSelecionado, 'Ops!');
					} else {
						
						var dataExibicao = data.split("-")[2] + "/" + data.split("-")[1] + "/" + data.split("-")[0];
						
						var msgEsmalteria = "";
						if (temEsmalteria) {
							msgEsmalteria = '<p>Esmalteria: ' + nomeProfissionalEsmalteria + ' (' + horarioEsmalteria + 'h)</p>';
						}
						
						var msgEscovaria = "";
						if (temEscovaria) {
							msgEscovaria = '<p>Escovaria: ' + nomeProfissionalEscovaria + ' (' + horarioEscovaria + 'h)</p>';
						}
						
						var dadosAgendamento = '<span>' +
													'<p>Unidade: Maria Gata Pituba</p>' +
													'<p>Serviços: ' + servicosnome + '</p>' +																				
													'<p>Quando: ' + dataExibicao + '</p>' +
													msgEsmalteria +
													msgEscovaria +
												'</span>';

						
						myApp.modal({
							title:  'Revise o agendamento',
							text: dadosAgendamento,
							buttons: [
							  {
								text: 'Vou revisar'
							  },
							  {
								text: 'Pode agendar',
								bold: true,
								onClick: function() {
									
									//Requisição para agendar 
									$.ajax({
										url: "http://mariagata.com.br/sistema/mariagata.php",
										type: 'POST',
										data: {
											a: 'confirmaragendamento',
											cpf: $("#cadastro_cpf"),
											nome: $("#cadastro_nome"),
											email: $("#cadastro_email"),
											celular: $("#cadastro_celular"),
											filial: filial,
											data: data,
											servicos: servicos,
											funcionarioEsmalteria: IdProfissionalEsmalteria,
											horarioEsmalteria: horarioEsmalteria,
											funcionarioEscovaria: IdProfissionalEscovaria,
											horarioEscovaria: horarioEscovaria
										},
										beforeSend: function( xhr ) {
											myApp.showPreloader('Confirmando Agendamento...');
										},
										context: document.body
										
									})
									.always(function() {		
										myApp.hidePreloader();
									})
									.fail(function(jqXHR, textStatus, errorThrown) {
										myApp.alert('Desculpe!! Ocorreu um erro inesperado. Por favor, feche e abra novamente o APP ou entre em contato pelo Whatsapp Maria Gata: 71 8879-1014.', 'Maria Gata');
									})
									.done(function(ret) {

										//Teste se o objeto retornao é JSON, ou seja, existem dados
										var jsonRetorno = jQuery.parseJSON(ret);
											
										if (jsonRetorno.resultado == 'SUCESSO') {			
											myApp.alert(jsonRetorno.mensagem, 'Parabéns!');
											//Volta para a tela inicial
											//mainView.router.load({
											//	url: "index.html"
											//});
										} else {
											myApp.alert(jsonRetorno.mensagem, 'Maria Gata');
										}			
										
									});	
								}
							  }
							]
						});
								
					} //Fim if/else msgNaoSelecionado != ""
					
				}); //Fim .click
				
				
			} // Fim onDeviceReady()
						
		}); //Fim document.ready()
		
		
		//document.addEventListener('deviceready', function () {
		//}, false); //Fim deviceready
		
	</script>
	

  </body>
</html>